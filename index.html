<html>
<head>
<title>pgomap</title>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.0.0-beta.2.rc.2/leaflet.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.0.0-beta.2.rc.2/leaflet.css">
<style type="text/css">
#map {
  height: 400px;
}
</style>
</head>
<body>
<div id="map"></div>

<script language="JavaScript">
var map = L.map('map').setView([22.33319, 114.160886], 15);

L.tileLayer(
  'http://{s}.tile.osm.org/{z}/{x}/{y}.png', 
  //'http://maps.wikimedia.org/osm-intl/{z}/{x}/{y}.png',
  {
    maxZoom: 18
  }).addTo(map);

var theIcon = L.icon({
    iconUrl: 'https://img.icons8.com/color/50/000000/pokestop-blue.png',
    iconSize:     [40,40], 
    iconAnchor:   [20,45], 
    popupAnchor:  [0,-30] 
});

var x = 22.33319; var y = 114.160886; //SSP
//var x=22.341358; var y=114.136661; //LCK
var r = 0.01;

var query = "select A,B,C where ((A-" + x + ")*(A-" + x + ")+(B-" + y + ")*(B-" + y + "))<" + (r * r) + " limit 100";
query = encodeURIComponent(query);

var base = "https://docs.google.com/spreadsheets/d/";
var sheetId = "15mDubG0SAB89kYZ_S9vqYUhFOUeHwTkLZ7MS9Y6zjOU";
var gridId = "1042843836";
var url = base + sheetId + "/gviz/tq?gid=" + gridId + "&tq=" + query + "&tqx=responseHandler:_";

$.get(url, function(jsonp) {
  var start = jsonp.indexOf("_(")+2;
  var end = jsonp.lastIndexOf(")");
  var json = jsonp.substring(start, end);
  json = JSON.parse(json);

  $.each(json.table.rows, function(idx, cells) {

    var lat = cells.c[0].v;
    var lng = cells.c[1].v;
    var gnm = cells.c[2].v;
    
    //L.marker([lat, lng]).addTo(map);

L.marker([lat, lng], {icon: theIcon}).addTo(map).bindPopup("( "+idx+" )<hr><b>"+gnm+"</b>"); //.openPopup();

  });
});



/*
https://img.icons8.com/color/50/000000/pokestop-blue.png
https://img.icons8.com/color/50/000000/pokestop-violette.png

https://img.icons8.com/color/50/000000/pokestop.png
https://img.icons8.com/color/50/000000/pokestop-violette-cube.png
*/



/*

var tileServer = {
  'standard': {
    urlTemplate: 'http://{s}.tile.osm.org/{z}/{x}/{y}.png',
    attribution: 'Data © <a href="http://osm.org/copyright">OpenStreetMap</a>'
  },
  'WikimediaMaps': {
    urlTemplate: 'http://maps.wikimedia.org/osm-intl/{z}/{x}/{y}.png',
    attribution: 'Maps © <a href="https://maps.wikimedia.org">Wikimedia Maps</a> Data © <a href="http://osm.org/copyright">OpenStreetMap</a>'
  },
  'OpenMapQuest': {
    urlTemplate: 'http://otile1.mqcdn.com/tiles/1.0.0/osm/{z}/{x}/{y}.png',
    attribution: 'Maps © <a href="http://open.mapquest.com/">MapQuest Open </a> Data © <a href="http://osm.org/copyright">OpenStreetMap</a>'
  },
  'OpenCycleMap': {
    urlTemplate: 'http://{s}.tile.opencyclemap.org/cycle/{z}/{x}/{y}.png',
    attribution: 'Maps © <a href="http://www.thunderforest.com/">Thunderforest</a>, Data © <a href="http://osm.org/copyright">OpenStreetMap</a>'
  },
  'TransportMap': {
    urlTemplate: 'http://{s}.tile2.opencyclemap.org/transport/{z}/{x}/{y}.png',
    attribution: 'Maps © <a href="http://www.thunderforest.com/">Thunderforest</a>, Data © <a href="http://osm.org/copyright">OpenStreetMap</a>'
  },
  'StamenToner': {
    urlTemplate: 'http://{s}.tile.stamen.com/toner/{z}/{x}/{y}.png',
    attribution: 'Maps © <a href="http://stamen.com/">Stamen</a>, Data © <a href="http://osm.org/copyright">OpenStreetMap</a>'
  },
  'StamenWatercolor': {
    urlTemplate: 'http://{s}.tile.stamen.com/watercolor/{z}/{x}/{y}.png',
    attribution: 'Maps © <a href="http://stamen.com/">Stamen</a>, Data © <a href="http://osm.org/copyright">OpenStreetMap</a>'
  },
  'CartoDB': {
    urlTemplate: 'http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png',
    attribution: 'Maps © <a href="http://cartodb.com/attributions">CartoDB</a>, Data © <a href="http://osm.org/copyright">OpenStreetMap</a>'
  },
  'x': {
    urlTemplate: '.png',
    attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
  }
   
}
*/</script>
</body>
</html>
