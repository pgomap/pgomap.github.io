<html>
<head>
<title>pgomap</title>
<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?v=3&amp;sensor=false"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<style type="text/css">
<!--
body {
  margin: 0;
  padding: 0;
  font: 12px sans-serif;
}

h1,
p {
  margin: 0;
  padding: 0;
}
//-->
</style>
</head>
<body>
<div id="map_div"></div>

<script language="JavaScript">
var map;

google.maps.event.addDomListener(window, "load", function() {

  var infoWindow = new google.maps.InfoWindow();
  var mapOptions = {
    center: new google.maps.LatLng(22.33319, 114.160886),
    zoom: 13,
    mapTypeId: google.maps.MapTypeId.ROADMAP
  };
  var map = new google.maps.Map(document.getElementById("map_div"), mapOptions);

  var x = 22.33319; var y = 114.160886; //SSP
  //var x=22.341358; var y=114.136661; //LCK
  var r = 0.01;
  var query = "select A,B,C where ((A-"+x+")*(A-"+x+")+(B-"+y+")*(B-"+y+"))<"+(r*r)+" limit 100";
  query = encodeURIComponent(query);

  var base = "https://docs.google.com/spreadsheets/d/";
  var sheetId = "15mDubG0SAB89kYZ_S9vqYUhFOUeHwTkLZ7MS9Y6zjOU";
  var gridId = "1042843836";
  var url = base + sheetId +"/gviz/tq?gid="+gridId +"&tq="+query+"&tqx=responseHandler:callback";

  $.get(url, function(jsonp) {
    var start = jsonp.indexOf("callback(");
    var end = jsonp.lastIndexOf(")");
    var json = jsonp.substring(start+9, end);
    json = JSON.parse(json);

    $.each(json.table.rows, function(idx, cells) {

			var lat = cells.c[0].v;
      var lng = cells.c[1].v;
      var gnm = cells.c[2].v;
      
      var marker = new google.maps.Marker({
        position: new google.maps.LatLng(lat,lng),
        map: map
      });
      google.maps.event.addListener(marker, "click", function() {
        infoWindow.setContent("( "+idx+" )<hr><b>"+gnm+"</b>");
        infoWindow.open(map, this);
      });

    });
  });

});
</script>
</body>
</html>
