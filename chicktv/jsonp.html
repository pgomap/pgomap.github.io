<html>
<head>
<title>new json</title>
</head>
<body>


<script language="JavaScript">
var baseurl = location.href;
if(baseurl.indexOf('#') < 0) { //mix both sources
	var params = "alancml,whitewing918".split(',');
	var url1 = "https://live.sk-knower.com/skgamerversion_api.php?page="+ params[0];
	url1 = 'https://json2jsonp.com/?url='+ encodeURIComponent(url1) +'&callback=json_';
	url1 += params[0].substring(0,3).toLowerCase();
	var js1 = document.createElement('script');
	js1.src = url1;
	document.getElementsByTagName('body')[0].appendChild(js1);

	var url2 = "https://live.sk-knower.com/skgamerversion_api.php?page="+ params[1];
	url2 = 'https://json2jsonp.com/?url='+ encodeURIComponent(url2) +'&callback=json_';
	url2 += params[1].substring(0,3).toLowerCase();
	var js2 = document.createElement('script');
	js2.src = url2;
	document.getElementsByTagName('body')[0].appendChild(js2);

}

var data1 = ''; var data2 = '';
function json_ala(data) {
	data1 = eval(data);
	if(is1paramMode) json(data);
	else if(data2!='') doBoth();
}
function json_whi(data) {
	data2 = eval(data);
	if(is1paramMode) json(data);
	else if(data1!='') doBoth();
}
function doBoth() {
	var rst = "https://pgomap.github.io/chicktv/?#";
	var rst1 = ''; var rst2 = '';
	for(var i=0; i < data1.channels.length; i++) {	
	  var dpname = data1.channels[i].displayname.trim();
	  if(dpname.indexOf(":hide:") < 0) {
		var platform = data1.channels[i].platform.trim();
		var details = data1.channels[i].details.trim();
		if(platform == 'twitch')
		   rst1 += details +';';
		else if(platform == 'okru')
		   rst1 += details +'_ok;';
	  }
	}
	for(var i=0; i < data2.channels.length; i++) {	
	  var dpname = data2.channels[i].displayname.trim();
	  if(dpname.indexOf(":hide:") < 0) {
		var platform = data2.channels[i].platform.trim();
		var details = data2.channels[i].details.trim();
		if(platform == 'twitch')
		   rst2 += details +';';
		else if(platform == 'okru')
		   rst2 += details +'_ok;';
	  }
	}
	//todo: check if ch is online?
	
	rst2 = ';'+ rst2 +';';
	rst2 = rst2.split(';;').join(';');
	if(rst1.charAt(0)==';') rst1 = rst1.substring(1); 
	if(rst1.charAt(rst1.length-1)==';') rst1 = rst1.substring(0,rst1.length-1); 
	var ary = rst1.split(';');
	for(var i=0; i < ary.length; i++) {
		if(rst2.indexOf(';'+ary[i]+';') >= 0)
			ary[i] = ';';
	}
	rst1 = ary.join(';');
	rst1 = rst1 +';'+ rst2;
	while(rst1.indexOf(';;')>=0)
		rst1 = rst1.split(';;').join(';');
	if(rst1.charAt(0)==';') rst1 = rst1.substring(1); 
	if(rst1.charAt(rst1.length-1)==';') rst1 = rst1.substring(0,rst1.length-1); 

	var tmp = '';
	rst1 = rst1.split(';');
	for(var i=0;i<rst1.length;i++)
		tmp += '/'+rst1[i];
	tmp = tmp.substring(1);
	
	location.href = rst + tmp;
}

//================================================================

function json(data) {
  //var json = JSON.parse(data);  
  var json = eval(data);

  var rst = "https://pgomap.github.io/chicktv/?#";
  for(var i=0; i < data.channels.length; i++) {
	  //setdefaul / displayname / platform / details
	  
	  var dpname = data.channels[i].displayname.trim();
	  if(dpname.indexOf(":hide:") < 0) {
		var platform = data.channels[i].platform.trim();
		var details = data.channels[i].details.trim();
		
		//rst += dpname+"__|__"+platform +"__|__"+ details +"<br>";
		if(platform == 'twitch')
		   rst += details +'/';
		else if(platform == 'okru')
		   rst += details +'_ok/';
	  }
  }

  //var elm = document.createElement('div');
  //elm.innerHTML = '<p>'+rst+'</p>';
  //document.getElementsByTagName('body')[0].appendChild(elm);
  location.href = rst;
}

var is1paramMode = false;
if(baseurl.indexOf('#') > 0) {
	var params = baseurl.substring(baseurl.indexOf('#')+1);
	var url = "https://live.sk-knower.com/skgamerversion_api.php?page="+ params;
	url = 'https://json2jsonp.com/?url='+ encodeURIComponent(url) +'&callback=json_';
	url += params.substring(0,3).toLowerCase();

	is1paramMode = true;
	var js = document.createElement('script');
	var timestamp = Math.floor(Date.now() / 1000);
	js.src = url //+ "&ts=" + timestamp;
	document.getElementsByTagName('body')[0].appendChild(js);
}

</script>

</body>
</html>
